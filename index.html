<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HellGPT</title>
  <style>
    body { background: black; color: red; font-family: 'Courier New', monospace; }
    #chat-box { width: 100%; height: 300px; overflow-y: scroll; border: 1px solid red; padding: 10px; margin-bottom: 10px; }
    #controls { margin-top: 10px; }
    select, button, input { background: #111; color: red; border: 1px solid red; padding: 5px; }
  </style>
</head>
<body>
  <h1>ðŸ”¥ HellGPT</h1>
  <p>Converse com a entidade da escuridÃ£o... se tiver coragem.</p>

  <label for="model-selection">Escolha o modelo:</label>
  <select id="model-selection"></select>
  <button id="download">Invocar o Inferno (Baixar Modelo)</button>

  <div id="chat-box"></div>

  <div id="controls">
    <input type="text" id="user-input" placeholder="Diga algo sombrio..." size="50" />
    <button id="send" disabled>Enviar</button>
  </div>

  <script type="module">
    import * as webllm from "https://esm.run/@mlc-ai/web-llm";

    let engine;
    const availableModels = webllm.prebuiltAppConfig.model_list.map(m => m.model_id);
    const selectedModel = availableModels[0];

    // Preenche o dropdown
    availableModels.forEach((modelId) => {
      const option = document.createElement("option");
      option.value = modelId;
      option.textContent = modelId;
      document.getElementById("model-selection").appendChild(option);
    });
    document.getElementById("model-selection").value = selectedModel;

    // Inicializar engine
    async function initializeWebLLMEngine() {
      const modelId = document.getElementById("model-selection").value;
      engine = new webllm.MLCEngine();
      await engine.loadModel(modelId);
      appendToChat("HellGPT", "Hehehe... Eu despertei. Pergunte-me algo.");
    }

    // Enviar mensagem
    async function onMessageSend() {
      const input = document.getElementById("user-input");
      const message = input.value.trim();
      if (!message) return;

      appendToChat("VocÃª", message);
      input.value = "";

      const reply = await engine.chat.completion({ stream: false, messages: [
        { role: "system", content: "VocÃª Ã© HellGPT, um vilÃ£o fictÃ­cio com respostas sombrias e teatrais, mas nunca reais ou perigosas." },
        { role: "user", content: message }
      ] });

      appendToChat("HellGPT", reply.choices[0].message.content);
    }

    function appendToChat(sender, text) {
      const box = document.getElementById("chat-box");
      const div = document.createElement("div");
      div.innerHTML = `<strong>${sender}:</strong> ${text}`;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    // Bind events
    document.getElementById("download").addEventListener("click", async () => {
      await initializeWebLLMEngine();
      document.getElementById("send").disabled = false;
    });

    document.getElementById("send").addEventListener("click", () => {
      onMessageSend();
    });

    // Enter key
    document.getElementById("user-input").addEventListener("keydown", (e) => {
      if (e.key === "Enter") document.getElementById("send").click();
    });
  </script>
</body>
</html>
